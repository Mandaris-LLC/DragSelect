!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).DragSelect=t()}(this,(function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function s(e,s,i){return s&&t(e.prototype,s),i&&t(e,i),e}function i(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function n(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,i)}return s}function r(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?n(Object(s),!0).forEach((function(t){i(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):n(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function o(e){return function(e){if(Array.isArray(e))return l(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return l(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);"Object"===s&&e.constructor&&(s=e.constructor.name);if("Map"===s||"Set"===s)return Array.from(e);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return l(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var s=0,i=new Array(t);s<t;s++)i[s]=e[s];return i}var c,a,u=function(e){return function(e,t,s){var i={y:document.body[e]>0?document.body[e]:document.documentElement[e],x:document.body[t]>0?document.body[t]:document.documentElement[t]};return{y:s&&s[e]>=0?s[e]:i.y,x:s&&s[t]>=0?s[t]:i.x}}("scrollTop","scrollLeft",e)},h={x:0,y:0},d=h,v=function(){function t(s){var n=s.Area,r=s.selectorAreaClass,o=s.selector;e(this,t),i(this,"modificationCallback",void 0),i(this,"modificationObserver",void 0),i(this,"node",void 0),this.Area=n,this.selectorAreaClass=r,this.selector=o,this.setup()}return s(t,[{key:"setup",value:function(){var e=this;this.node=f(this.selectorAreaClass),this.update(),this.modificationCallback=function(t){return e.update()},this.modificationObserver=new MutationObserver(this.modificationCallback),this.node.append(this.selector),document.body.append(this.node)}},{key:"start",value:function(){b(this.Area.node,this.modificationCallback,this.modificationObserver)}},{key:"update",value:function(){y(this.node,this.Area.node)}},{key:"stop",value:function(){m(this.modificationObserver,this.modificationCallback)}},{key:"teardown",value:function(){this.stop(),this.selector.remove(),this.node.remove()}}]),t}(),f=function(e){var t=document.createElement("div");return t.style.position="fixed",t.style.overflow="hidden",t.style.pointerEvents="none",t.classList.add(e),t},b=function(e,t,s){window.addEventListener("resize",t),window.addEventListener("scroll",t),s.observe(document.body,{subtree:!0,childList:!0,attributes:!0}),s.observe(e,{attributes:!0})},m=function(e,t){window.removeEventListener("resize",t),window.removeEventListener("scroll",t),e.disconnect()},y=function(e,t){var s=S(t),i=g(t);return e.style.top="".concat(s.top+i.top,"px"),e.style.left="".concat(s.left+i.left,"px"),e.style.width="".concat(s.width-i.left-i.right,"px"),e.style.height="".concat(s.height-i.top-i.bottom,"px"),e},p=function(){function t(){e(this,t),i(this,"subscribers",{})}return s(t,[{key:"subscribe",value:function(e,t){return Array.isArray(this.subscribers[e])||(this.subscribers[e]=[]),this.subscribers[e].push(t),this.subscribers[e].length-1}},{key:"unsubscribe",value:function(e,t,s){s?this.subscribers[e].splice(s,1):this.subscribers[e]=this.subscribers[e].filter((function(e){return e!==t}))}},{key:"publish",value:function(e,t){Array.isArray(this.subscribers[e])&&this.subscribers[e].forEach((function(e){return e(t)}))}}]),t}(),S=function(e){if(e instanceof Document)return{top:0,left:0,bottom:0,right:0,width:e.documentElement.clientWidth>0?e.documentElement.clientWidth:window.innerWidth,height:e.documentElement.clientHeight>0?e.documentElement.clientHeight:window.innerHeight};var t=e.getBoundingClientRect();return{top:t.top,left:t.left,bottom:t.bottom,right:t.right,width:t.width,height:t.height}},g=function(e){if(e instanceof HTMLDocument)return{top:0,bottom:0,left:0,right:0};var t=getComputedStyle(e);return{top:parseInt(t.borderTopWidth)||0,bottom:parseInt(t.borderBottomWidth)||0,left:parseInt(t.borderLeftWidth)||0,right:parseInt(t.borderRightWidth)||0}},_=function(e,t){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(!t)return{x:0,y:0};"touches"in t&&"touchend"!==t.type&&(c=t);var i="touches"in t?c.touches[0]:t,n={x:i.pageX,y:i.pageY},r=S(e),o=u();return{x:(n.x-r.left-o.x)/s,y:(n.y-r.top-o.y)/s}},k=function(e,t,s,i,n,o){var l=_(e,o),c=u(t),a=c.x-s.x,h=c.y-s.y;n&&r({},d={x:a*n-a,y:h*n-h});var v=r({},d),f=a+v.x,b=h+v.y,m={};return l.x>i.x-f?(m.x=i.x-f,m.w=l.x-i.x+f):(m.x=l.x,m.w=i.x-l.x-f),l.y>i.y-b?(m.y=i.y-b,m.h=l.y-i.y+b):(m.y=l.y,m.h=i.y-l.y-b),m},C=function(e,t){return e.x<t.x+t.w&&e.x+e.w>t.x&&e.y<t.y+t.h&&e.h+e.y>t.y},w=function(e,t,s,i){if(x(e,s,i)){var n={y:t.getBoundingClientRect().top,x:t.getBoundingClientRect().left,h:t.offsetHeight,w:t.offsetWidth},r=e.getBoundingClientRect(),o={y:r.top,x:r.left,h:r.height,w:r.width};return!!C(n,o)}},x=function(e,t,s){if(t.contains(e)&&function(e){var t=u(e);if(t.x||t.y)return!0;var s=e instanceof HTMLDocument?e.documentElement:e;return s.scrollTop=1,!!s.scrollTop}(t))return!0;var i={y:s.getBoundingClientRect().top,x:s.getBoundingClientRect().left,h:s.offsetHeight,w:s.offsetWidth},n=e.getBoundingClientRect(),r={y:n.top,x:n.left,h:n.height,w:n.width};return!!C(i,r)},P=function(e,t,s){return!!t||e.some((function(e){return s[e]}))},E=function(e){return e?!Array.isArray(e)&&(e instanceof HTMLElement||e instanceof SVGElement)?[e]:o(e):[]},L=function(e,t){return e.style.left="".concat(t.x,"px"),e.style.top="".concat(t.y,"px"),e.style.width="".concat(t.w,"px"),e.style.height="".concat(t.h,"px"),e};return function(){function t(s){var n=this,r=s.area,o=void 0===r?document:r,l=s.autoScrollSpeed,c=void 0===l?1:l,a=s.customStyles,u=void 0!==a&&a,h=s.hoverClass,d=void 0===h?"ds-hover":h,f=s.multiSelectKeys,b=void 0===f?["ctrlKey","shiftKey","metaKey"]:f,m=s.multiSelectMode,y=void 0!==m&&m,p=s.selectableClass,S=void 0===p?"ds-selectable":p,g=s.selectables,_=void 0===g?[]:g,k=s.selectedClass,C=void 0===k?"ds-selected":k,w=s.selector,x=void 0===w?void 0:w,P=s.selectorClass,L=void 0===P?"ds-selector":P,O=s.selectorAreaClass,A=void 0===O?"ds-selector-area":O,I=s.zoom,D=void 0===I?1:I,M=s.callback,T=s.onDragMove,j=s.onDragStart,U=s.onDragStartBegin,B=s.onElementSelect,K=s.onElementUnselect;e(this,t),i(this,"_multiSelectKeyPressed",!1),i(this,"_initialCursorPos",{x:0,y:0}),i(this,"_newCursorPos",{x:0,y:0}),i(this,"_previousCursorPos",{x:0,y:0}),i(this,"_initialScroll",{x:0,y:0}),i(this,"_selected",[]),i(this,"_prevSelected",[]),i(this,"_autoScrollInterval",null),i(this,"_onClick",(function(e){return n.handleClick(e)})),i(this,"_startUp",(function(e){return n.startUp(e)})),i(this,"_handleMove",(function(e){return n.handleMove(e)})),i(this,"_end",(function(e){return n.reset(e,!0)})),this.selectedClass=C,this.hoverClass=d,this.selectorClass=L,this.selectableClass=S,this.selectables=[],this._initialSelectables=E(_),this.multiSelectKeys=b,this.multiSelectMode=y,this.autoScrollSpeed=0===c?0:c,this.area=function(e){if(e instanceof HTMLDocument)return e;var t=getComputedStyle(e).position;return"absolute"===t||"relative"===t||"fixed"===t||(e.style.position="relative"),e}(o),this.customStyles=u,this.zoom=D,this._setupPubSub(),this._callbacksTemp({callback:M,onDragMove:T,onDragStart:j,onDragStartBegin:U,onElementSelect:B,onElementUnselect:K}),this.selector=x||function(e){var t=document.createElement("div");return t.style.position="absolute",e||(t.style.background="rgba(0, 0, 255, 0.1)",t.style.border="1px solid rgba(0, 0, 255, 0.45)",t.style.display="none",t.style.pointerEvents="none"),t}(this.customStyles),this.selector.classList.add(this.selectorClass),this.SelectorArea=new v({Area:{node:this.area},selectorAreaClass:A,selector:this.selector}),this.start()}return s(t,[{key:"_setupPubSub",value:function(){this.PubSub=new p,this.subscribe=this.PubSub.subscribe.bind(this.PubSub),this.unsubscribe=this.PubSub.unsubscribe.bind(this.PubSub),this.publish=this.PubSub.publish.bind(this.PubSub)}},{key:"_callbacksTemp",value:function(e){var t=e.callback,s=e.onDragMove,i=e.onDragStart,n=e.onDragStartBegin,r=e.onElementSelect,o=e.onElementUnselect,l=function(e,t){return console.warn("[DragSelect] ".concat(e,' is being deprecated. Use DragSelect.subscribe("').concat(t,'", (callbackObject) => {}) instead. See docs for more info'))};t&&(l("callback","callback"),this.subscribe("callback",(function(e){var s=e.items,i=(e.item,e.event);return t(s,i)}))),s&&(l("onDragMove","dragmove"),this.subscribe("dragmove",(function(e){e.items,e.item;var t=e.event;return s(t)}))),i&&(l("onDragStart","dragstart"),this.subscribe("dragstart",(function(e){e.items,e.item;var t=e.event;return i(t)}))),n&&(l("onDragStartBegin","dragstartbegin"),this.subscribe("dragstartbegin",(function(e){e.items,e.item;var t=e.event;return n(t)}))),r&&(l("onElementSelect","elementselect"),this.subscribe("elementselect",(function(e){e.items;var t=e.item,s=e.event;return r(t,s)}))),o&&(l("onElementUnselect","elementunselect"),this.subscribe("elementunselect",(function(e){e.items;var t=e.item,s=e.event;return o(t,s)})))}},{key:"_handleSelectables",value:function(e,t,s){for(var i=0;i<e.length;i++){var n=e[i],r=this.selectables.indexOf(n);r<0&&!t?this._addSelectable(n,s):r>-1&&t&&this._removeSelectable(n,r,s)}}},{key:"_addSelectable",value:function(e,t){e.classList.add(this.selectableClass),e.addEventListener("click",this._onClick),this.selectables.push(e),t&&this._selected.indexOf(e)<0&&(e.classList.add(this.selectedClass),this._selected.push(e))}},{key:"_removeSelectable",value:function(e,t,s){e.classList.remove(this.hoverClass),e.classList.remove(this.selectableClass),e.removeEventListener("click",this._onClick),this.selectables.splice(t,1),s&&this._selected.indexOf(e)>-1&&(e.classList.remove(this.selectedClass),this._selected.splice(this._selected.indexOf(e),1))}},{key:"handleClick",value:function(e){if(!this.mouseInteraction&&2!==e.button){var t=e.target;this.selectables.includes(t)&&x(t,this.area,this.SelectorArea.node)&&(this._multiSelectKeyPressed=P(this.multiSelectKeys,this.multiSelectMode,e),this._multiSelectKeyPressed?this._prevSelected=this._selected.slice():this._prevSelected=[],this.checkIfInsideSelection(!0),this.toggle(t),this._end(e))}}},{key:"start",value:function(){this._handleSelectables(this._initialSelectables),this.area.addEventListener("mousedown",this._startUp),this.area.addEventListener("touchstart",this._startUp,{passive:!1}),this.SelectorArea.start()}},{key:"startUp",value:function(e){if("touchstart"===e.type&&e.preventDefault(),this.mouseInteraction=!0,2!==e.button&&function(e,t){"touches"in t&&"touchend"!==t.type&&(a=t);var s="touches"in t?a.touches[0]:t,i={x:s.clientX,y:s.clientY,w:0,h:0},n={x:e.getBoundingClientRect().left,y:e.getBoundingClientRect().top,w:e.offsetWidth,h:e.offsetHeight};return C(i,n)}(this.SelectorArea.node,e)){if(this.PubSub.publish("dragstartbegin",{items:this.getSelection(),event:e}),this._breaked)return!1;if(this.selector.style.display="block",this._multiSelectKeyPressed=P(this.multiSelectKeys,this.multiSelectMode,e),this._multiSelectKeyPressed?this._prevSelected=this._selected.slice():this._prevSelected=[],this._getStartingPositions(e),this.checkIfInsideSelection(!0),this.selector.style.display="none",this.PubSub.publish("dragstart",{items:this.getSelection(),event:e}),this._breaked)return!1;this.area.removeEventListener("mousedown",this._startUp),this.area.removeEventListener("touchstart",this._startUp,{passive:!1}),document.addEventListener("mousemove",this._handleMove),document.addEventListener("touchmove",this._handleMove,{passive:!1}),document.addEventListener("mouseup",this._end),document.addEventListener("touchend",this._end)}}},{key:"_getStartingPositions",value:function(e){this._initialCursorPos=this._newCursorPos=_(this.SelectorArea.node,e),this._initialScroll=u(this.area);var t={};t.x=this._initialCursorPos.x+this._initialScroll.x,t.y=this._initialCursorPos.y+this._initialScroll.y,t.w=0,t.h=0,L(this.selector,t)}},{key:"handleMove",value:function(e){if(this._newCursorPos=_(this.SelectorArea.node,e),this.PubSub.publish("dragmove",{items:this.getSelection(),event:e}),this._breaked)return!1;this.selector.style.display="block",this._moveSelection(e),this._setScrollState(e)}},{key:"_moveSelection",value:function(e,t){L(this.selector,k(this.SelectorArea.node,this.area,this._initialScroll,this._initialCursorPos,t,e)),this.checkIfInsideSelection(null)}},{key:"checkIfInsideSelection",value:function(e){for(var t=!1,s=0,i=this.selectables.length;s<i;s++){var n=this.selectables[s];w(n,this.selector,this.area,this.SelectorArea.node)?(this._handleSelection(n,e),t=!0):this._handleUnselection(n,e)}return t}},{key:"_handleSelection",value:function(e,t){if(e.classList.contains(this.hoverClass)&&!t)return!1;this._selected.includes(e)?this._multiSelectKeyPressed&&this.unselect(e):this.select(e),e.classList.add(this.hoverClass)}},{key:"_handleUnselection",value:function(e,t){if(!e.classList.contains(this.hoverClass)&&!t)return!1;var s=this._selected.includes(e),i=this._prevSelected.includes(e);s&&!i?this.unselect(e):!s&&i&&this.select(e),e.classList.remove(this.hoverClass)}},{key:"select",value:function(e){return!(this._selected.indexOf(e)>-1)&&(this._selected.push(e),e.classList.add(this.selectedClass),this.PubSub.publish("elementselect",{items:this.getSelection(),item:e}),!this._breaked&&e)}},{key:"unselect",value:function(e){return!(this._selected.indexOf(e)<0)&&(this._selected.splice(this._selected.indexOf(e),1),e.classList.remove(this.selectedClass),this.PubSub.publish("elementunselect",{items:this.getSelection(),item:e}),!this._breaked&&e)}},{key:"toggle",value:function(e){return this._selected.includes(e)?this.unselect(e):this.select(e),e}},{key:"_setScrollState",value:function(e){var t=this,s=function(e,t){var s=_(e,t),i=S(e),n=10,r=10,o=[];return s.y<r&&o.push("top"),i.height-s.y<r&&o.push("bottom"),i.width-s.x<n&&o.push("right"),s.x<n&&o.push("left"),o}(this.SelectorArea.node,e);s.length?(this._autoScrollInterval&&window.clearInterval(this._autoScrollInterval),this._autoScrollInterval=window.setInterval((function(){t._newCursorPos=_(t.SelectorArea.node,e),t._moveSelection(e,t.zoom),function(e,t,s){var i=document&&document.documentElement&&document.documentElement.scrollTop&&document.documentElement,n=e instanceof HTMLDocument?i||document.body:e,r=t.includes("top")&&n.scrollTop>0,o=t.includes("bottom"),l=t.includes("left")&&n.scrollLeft>0,c=t.includes("right");r&&(n.scrollTop-=1*s),o&&(n.scrollTop+=1*s),l&&(n.scrollLeft-=1*s),c&&(n.scrollLeft+=1*s)}(t.area,s,t.autoScrollSpeed)}))):!s.length&&this._autoScrollInterval&&(window.clearInterval(this._autoScrollInterval),this._autoScrollInterval=null)}},{key:"reset",value:function(e,t){var s=this;if(this._previousCursorPos=_(this.SelectorArea.node,e),r({},d=h),document.removeEventListener("mouseup",this._end),document.removeEventListener("touchend",this._end),document.removeEventListener("mousemove",this._handleMove),document.removeEventListener("touchmove",this._handleMove,{passive:!1}),this.area.addEventListener("mousedown",this._startUp),this.area.addEventListener("touchstart",this._startUp,{passive:!1}),t&&this.PubSub.publish("callback",{items:this.getSelection(),event:e}),this._breaked)return!1;this.selector.style.width="0",this.selector.style.height="0",this.selector.style.display="none",this._autoScrollInterval&&(window.clearInterval(this._autoScrollInterval),this._autoScrollInterval=null),setTimeout((function(){return s.mouseInteraction=!1}),100)}},{key:"break",value:function(){var e=this;this._breaked=!0,setTimeout((function(){return e._breaked=!1}),100)}},{key:"stop",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=arguments.length>2?arguments[2]:void 0;this.reset(!1,s),this.SelectorArea.stop(),this.area.removeEventListener("mousedown",this._startUp),this.area.removeEventListener("touchstart",this._startUp,{passive:!1}),document.removeEventListener("mouseup",this._end),document.removeEventListener("touchend",this._end),this._handleSelectables(o(this.selectables),e,t)}},{key:"getSelection",value:function(){return o(this._selected)}},{key:"addSelection",value:function(e,t,s){var i=this;return E(e).forEach((function(e){return i.select(e)})),s||this.addSelectables(e),t&&this.PubSub.publish("callback",{items:this.getSelection()}),this.getSelection()}},{key:"removeSelection",value:function(e,t,s){var i=this;return E(e).forEach((function(e){return i.unselect(e)})),s&&this.removeSelectables(e),t&&this.PubSub.publish("callback",{items:this.getSelection()}),this.getSelection()}},{key:"toggleSelection",value:function(e,t,s){for(var i=E(e),n=0,r=i.length;n<r;n++){var o=i[n];this._selected.indexOf(o)<0?this.addSelection(o,t,s):this.removeSelection(o,t,s)}return this._selected}},{key:"setSelection",value:function(e,t,s){return this.clearSelection(),this.addSelection(e,t,s),this._selected}},{key:"clearSelection",value:function(e){var t=this;return this._selected.slice().forEach((function(e){return t.unselect(e)})),e&&this.PubSub.publish("callback",{items:this.getSelection()}),this.getSelection()}},{key:"addSelectables",value:function(e,t){var s=E(e);return this._handleSelectables(s,!1,t),e}},{key:"getSelectables",value:function(){return this.selectables}},{key:"setSelectables",value:function(e,t,s){return this._handleSelectables(this.getSelectables(),!0,t),this.addSelectables(e,s)}},{key:"removeSelectables",value:function(e,t){var s=E(e);return this._handleSelectables(s,!0,t),e}},{key:"getInitialCursorPosition",value:function(){return this._initialCursorPos}},{key:"getCurrentCursorPosition",value:function(){return this._newCursorPos}},{key:"getPreviousCursorPosition",value:function(){return this._previousCursorPos}},{key:"getCursorPositionDifference",value:function(e){var t=this.getCurrentCursorPosition(),s=e?this.getPreviousCursorPosition():this.getInitialCursorPosition();return{x:t.x-s.x,y:t.y-s.y}}}]),t}()}));